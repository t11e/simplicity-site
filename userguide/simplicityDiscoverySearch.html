<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Simplicity Widgets - simplicityDiscoverySearch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="//cdn.transparensee.com/lib/bootstrap/2.1.1/bootstrap.min.css" rel="stylesheet">
    <link href="//cdn.transparensee.com/lib/bootstrap/2.1.1/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/themes/base/jquery-ui.css" rel="stylesheet">
    <link href="//cdn.transparensee.com/simplicity/3.2/simplicity.min.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/documentation.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-static-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Simplicity Widgets</a>
          <ul class="nav">
            
              
                <li><a href="/">home</a></li>
              
            
              
                <li class="active"><a href="/userguide/" class="active">userguide</a></li>
              
            
              
                <li><a href="/download.html">download</a></li>
              
            
              
                <li><a href="/jsdoc/">jsdoc</a></li>
              
            
              
                <li><a href="/changelog.html">changelog</a></li>
              
            
          </ul>
        </div>
      </div>
    </div>

    
      <header class="subhead">
        <div class="container">
          <h1>simplicityDiscoverySearch</h1>
          
            <p class="lead">Setting up the search flow.</p>
          
        </div>
      </header>
    

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <div class="container">
<div class='userguide-nav row'>
    <div class='span4'>
        <ul class='nav nav-list'>
            <li class='nav-header'>Basics</li>
            <li class=''><a href='/userguide/'>Getting started</a></li>
            <li class=''><a href='/userguide/primer.html'>Primer</a></li>
            <li class=''><a href='/userguide/widgetgroups.html'>Widget groups</a></li>
        </ul>
    </div>
    <div class='span4'>
        <ul class='nav nav-list'>
            <li class='nav-header'>Search</li>
            <li class=''><a href='/userguide/simplicityState.html'>simplicityState</a></li>
            <li class='active'><a href='/userguide/simplicityDiscoverySearch.html'>simplicityDiscoverySearch</a></li>
            <li class=''><a href='/userguide/simplicityInputs.html'>simplicityInputs</a></li>
        </ul>
    </div>
    <div class='span4'>
        <ul class='nav nav-list'>
            <li class='nav-header'>Response Widgets</li>
            <li class=''><a href='/userguide/simplicitySearchResults.html'>simplicitySearchResults</a></li>
            <li class=''><a href='/userguide/simplicityFacetedSelect.html'>simplicityFacetedSelect</a></li>
        </ul>
    </div>
</div><div class='userguide-nav row'>
    <div class='span4'>
        <ul class='nav nav-list'>
            <li class='nav-header'>User Interface</li>
            <li class=''><a href='/userguide/simplicityFancySelect.html'>simplicityFancySelect</a></li>
            <li class=''><a href='/userguide/simplicitySelectSlider.html'>simplicitySelectSlider</a></li>
        </ul>
    </div>
    <div class='span4'>
        <ul class='nav nav-list'>
            <li class='nav-header'>Mapping</li>
            <li class=''><a href='/userguide/googleMaps.html'>Google Maps</a></li>
        </ul>
    </div>
    <div class='span4'>
        <ul class='nav nav-list'>
            <li class='nav-header'>Examples</li>
            <li class=''><a href='/userguide/example/gettingstarted.html'>Getting Started</a></li>
        </ul>
    </div>
</div><div class='page-header'>
  <h1>simplicityDiscoverySearch</h1>
</div>
<p>The <code>simplicityDiscoverySearch</code> widget coordinates with the <code>simplicityState</code> widget to perform the Ajax search. By default, whenever the state changes a search is performed.</p>
<div class='page-header'>
  <h1>Setup</h1>
</div>
<p>Pages have a snippet of JavaScript at the end of their <code>body</code> that configures the search.</p>

<p>The minimal block would be:</p>
<div class='highlight'><pre><code class='javascript'><span class='lineno'>1</span> <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>({</span>
<span class='lineno'>2</span>   <span class='nx'>url</span><span class='o'>:</span> <span class='s1'>&#39;/my_search_controller.php&#39;</span>
<span class='lineno'>3</span> <span class='p'>});</span>
</code></pre>
</div>
<p>Where as a more typical block is:</p>
<div class='highlight'><pre><code class='javascript'><span class='lineno'>1</span> <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>)</span>
<span class='lineno'>2</span>   <span class='p'>.</span><span class='nx'>simplicityState</span><span class='p'>(</span><span class='s1'>&#39;mergeQueryParams&#39;</span><span class='p'>)</span>
<span class='lineno'>3</span>   <span class='p'>.</span><span class='nx'>simplicityHistory</span><span class='p'>()</span>
<span class='lineno'>4</span>   <span class='p'>.</span><span class='nx'>simplicityState</span><span class='p'>(</span><span class='s1'>&#39;triggerChangeEvent&#39;</span><span class='p'>)</span>
<span class='lineno'>5</span>   <span class='p'>.</span><span class='nx'>simplicityPageSnapBack</span><span class='p'>()</span>
<span class='lineno'>6</span>   <span class='p'>.</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>({</span>
<span class='lineno'>7</span>     <span class='nx'>url</span><span class='o'>:</span> <span class='s1'>&#39;/my_search_controller.php&#39;</span>
<span class='lineno'>8</span>   <span class='p'>})</span>
<span class='lineno'>9</span>   <span class='p'>.</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>(</span><span class='s1'>&#39;search&#39;</span><span class='p'>);</span>
</code></pre>
</div>
<p>This enables several optional features, let&#8217;s run through each line.</p>

<ol>
<li>We bind all the page level widgets to the <code>body</code> element (our default location).</li>

<li><code>simplicityState(&#39;mergerQueryParams&#39;)</code> consumes parameters from the query string portion of the URL and applies them to the state. Concretely, the URL <code>http://example.com/search?example=hello+world&amp;category=3</code> would create the state <code>{&quot;example&quot;: &quot;hello world&quot;, &quot;category&quot;: &quot;3&quot;}</code>.</li>

<li><code>simplicityHistory()</code> enables the history plugin that uses the hash fragment of the URL to support browser back/forward buttons and to allow for bookmarking of the Ajax search state. Concretely, the URL <code>http://example.com/search#!example=hello+world&amp;category=3</code> would create the state <code>{&quot;example&quot;: &quot;hello world&quot;, &quot;category&quot;: &quot;3&quot;}</code> and the URL would be updated whenever the state is changed.</li>

<li><code>simplicityState(&#39;triggerChangeEvent&#39;)</code> causes the current state to be applied to all widgets by firing a <code>simplicityStateChange</code> event. The order of this in relation to the <code>mergeQueryParams</code> and <code>simplicityHistory</code> widget is important.</li>

<li><code>simplicityPageSnapBack()</code> watches the state and flips the page parameter whenever the other search parameters change.</li>

<li><code>simplicityDiscoverySearch({...})</code> is the only mandatory line to make search work. By default it will trigger a search whenever the state changes and it&#8217;s minimum configuration describes how it should communicate with the search service. This is described in more detail in the next section of this page.</li>

<li><code>simplicityDiscoverySearch(&#39;search&#39;)</code> triggers an immediate search, useful for when you are not doing any server side search as part of generating the page.</li>
</ol>
<div class='page-header'>
  <h1>Search Service</h1>
</div>
<p>The <code>simplicityDiscoverySearch</code> widget can perform Ajax search requests in a two different ways:</p>

<ol>
<li>directly to the Discovery Search Engine (via CORS), or</li>

<li>to a same-origin server-side search controller</li>
</ol>

<p>You&#8217;ll typically use direct engine searches for development purposes, and a server side search controller for a production site.</p>
<div class='page-header'>
  <h1>Server side search controller</h1>
</div><div class='highlight'><pre><code class='javascript'><span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>({</span>
    <span class='nx'>url</span><span class='o'>:</span> <span class='s1'>&#39;/my_search_controller.php&#39;</span>
<span class='p'>});</span>
</code></pre>
</div>
<p>Will make GET requests to the my_search_controller.php using the state as query parameters, and expect to receive a JSON document in our standard response format.</p>

<p>Concretely, the state:</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
    <span class='s2'>&quot;text&quot;</span><span class='o'>:</span> <span class='s2'>&quot;this is an example&quot;</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>Would be mapped to the URL:</p>

<pre><code>http://example.com/my_search_controller.php?text=this+is+an+example</code></pre>

<p>The server side search controller would build a Discovery Request from the query parameters, dispatch it to the Discovery Search Engine and then return a JSON document that fits this template:</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
  <span class='s2'>&quot;_discovery&quot;</span><span class='o'>:</span> <span class='p'>{</span>
    <span class='s2'>&quot;request&quot;</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='c1'>// Original, unmodified Discovery Request</span>
    <span class='p'>},</span>
    <span class='s2'>&quot;response&quot;</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='c1'>// Original, unmodified Discovery Response</span>
    <span class='p'>}</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;resultsHtml&quot;</span><span class='o'>:</span> <span class='s2'>&quot;Rendered results go here&quot;</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>The widgets would then process the response to insert the results directly into the page and update any facets, maps or other dynamic details as appropriate.</p>
<div class='page-header'>
  <h1>JavaScript search controller with direct engine query</h1>
</div><div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>my_search_controller</span> <span class='o'>=</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>state</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='kd'>var</span> <span class='nx'>discoveryRequest</span> <span class='o'>=</span> <span class='p'>{</span>
        <span class='nx'>criteria</span><span class='o'>:</span> <span class='p'>[],</span>
        <span class='nx'>pageSize</span><span class='o'>:</span> <span class='mi'>10</span>
    <span class='p'>};</span>
    <span class='k'>if</span> <span class='p'>(</span><span class='nx'>state</span><span class='p'>.</span><span class='nx'>text</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='nx'>discoveryRequest</span><span class='p'>.</span><span class='nx'>criteria</span><span class='p'>.</span><span class='nx'>push</span><span class='p'>({</span>
            <span class='nx'>dimension</span><span class='o'>:</span> <span class='s1'>&#39;text&#39;</span><span class='p'>,</span>
            <span class='nx'>value</span><span class='o'>:</span> <span class='nx'>state</span><span class='p'>.</span><span class='nx'>text</span>
        <span class='p'>});</span>
    <span class='p'>}</span>
    <span class='k'>return</span> <span class='nx'>discoveryRequest</span><span class='p'>;</span>
<span class='p'>};</span>
<span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>({</span>
    <span class='nx'>url</span><span class='o'>:</span> <span class='s1'>&#39;http://example.com:8090/ws/query&#39;</span><span class='p'>,</span>
    <span class='nx'>backend</span><span class='o'>:</span> <span class='s1'>&#39;engine&#39;</span><span class='p'>,</span>
    <span class='nx'>controllerCallback</span><span class='o'>:</span> <span class='nx'>my_search_controller</span>
<span class='p'>});</span>
</code></pre>
</div>
<p>This makes a direct POST request to the engine and uses the JavaScript function <code>my_search_controller</code> to create the Discovery Request from the state. You&#8217;ll need a <a href='http://en.wikipedia.org/wiki/Cross-origin_resource_sharing'>CORS</a> compatible browser to avoid any cross-origin sand-boxing issues.</p>
<div class='page-header'>
  <h1>Live search</h1>
</div>
<p>By default a search is triggered whenever the state changes. We call this &#8220;live search&#8221;. If you prefer to have the end user click on a button to trigger the search then you can set the <code>searchOnStateChange</code> option to <code>false</code> and manually call the <code>search</code> method on the <code>simplicityDiscoverySearch</code> widget from your click handler.</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>({</span>
    <span class='nx'>url</span><span class='o'>:</span> <span class='s1'>&#39;/my_search_controller.php&#39;</span><span class='p'>,</span>
    <span class='nx'>searchOnStateChange</span><span class='o'>:</span> <span class='kc'>false</span>
<span class='p'>});</span>
<span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#searchButton&#39;</span><span class='p'>).</span><span class='nx'>click</span><span class='p'>(</span><span class='kd'>function</span> <span class='p'>()</span> <span class='p'>{</span>
  <span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>(</span><span class='s1'>&#39;search&#39;</span><span class='p'>);</span>
<span class='p'>});</span>
</code></pre>
</div><div class='page-header'>
  <h1>Initial server side search</h1>
</div>
<p>If you&#8217;d like to SEO optimize your page, you can perform the first search when generating the HTML and splice that into the widget configuration.</p>

<p>To do so, you&#8217;d need to inject the state and search JSON objects into the generated page.</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>injectedState</span> <span class='o'>=</span> <span class='p'>{</span>
  <span class='s2'>&quot;example&quot;</span><span class='o'>:</span> <span class='s2'>&quot;my search string&quot;</span>
<span class='p'>};</span>
<span class='kd'>var</span> <span class='nx'>injectedSearch</span> <span class='o'>=</span> <span class='p'>{</span>
  <span class='s2'>&quot;_discovery&quot;</span><span class='o'>:</span> <span class='p'>{</span>
    <span class='s2'>&quot;request&quot;</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='c1'>// Original Discovery request goes here</span>
    <span class='p'>},</span>
    <span class='s2'>&quot;response&quot;</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='c1'>// Original Discovery response goes here</span>
    <span class='p'>}</span>
  <span class='p'>}</span>
<span class='p'>};</span>

<span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityState</span><span class='p'>({</span>
    <span class='nx'>initialState</span><span class='o'>:</span> <span class='nx'>injectedState</span><span class='p'>;</span>
<span class='p'>});</span>
<span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;#searchNav :input&#39;</span><span class='p'>).</span><span class='nx'>simplicityInputs</span><span class='p'>();</span>
<span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityState</span><span class='p'>(</span><span class='s1'>&#39;triggerChangeEvent&#39;</span><span class='p'>);</span>

<span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>({</span>
    <span class='nx'>url</span><span class='o'>:</span> <span class='s1'>&#39;/my_search_controller.php&#39;</span><span class='p'>,</span>
    <span class='nx'>initialSearchResponse</span><span class='o'>:</span> <span class='nx'>injectedSearch</span><span class='p'>;</span>
<span class='p'>});</span>
</code></pre>
</div><div class='page-header'>
  <h1>Programmatic search</h1>
</div>
<p>At any point you can call the <code>search</code> method of <code>simplicityDiscoverySearch</code> to trigger a search.</p>

<p>To search using the current state:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>(</span><span class='s1'>&#39;search&#39;</span><span class='p'>);</span>
</code></pre>
</div>
<p>To ignore the current state and force a particular search:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>(</span><span class='s1'>&#39;search&#39;</span><span class='p'>,</span> <span class='p'>{</span>
  <span class='s1'>&#39;example&#39;</span><span class='o'>:</span> <span class='s1'>&#39;custom overriden search&#39;</span>
<span class='p'>});</span>
</code></pre>
</div><div class='page-header'>
  <h1>Search Response</h1>
</div>
<p>The current search response is buffered allowing you access it at any time.</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>$</span><span class='p'>(</span><span class='s1'>&#39;body&#39;</span><span class='p'>).</span><span class='nx'>simplicityDiscoverySearch</span><span class='p'>(</span><span class='s1'>&#39;searchResponse&#39;</span><span class='p'>);</span>
</code></pre>
</div>
<p>This returns a JSON compatible object that should follow our standard template. Actual contents vary depending on the search controller implementation.</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
  <span class='s2'>&quot;_discovery&quot;</span><span class='o'>:</span> <span class='p'>{</span>
    <span class='s2'>&quot;request&quot;</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='c1'>// Original, unmodified Discovery Request</span>
    <span class='p'>},</span>
    <span class='s2'>&quot;response&quot;</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='c1'>// Original, unmodified Discovery Response</span>
    <span class='p'>}</span>
  <span class='p'>},</span>
  <span class='s2'>&quot;resultsHtml&quot;</span><span class='o'>:</span> <span class='s2'>&quot;Rendered results go here&quot;</span>
<span class='p'>}</span>
</code></pre>
</div>
    </div>

    <footer class="footer">
      <div class="container">
        <p class="pull-right">
            <a href="#" onclick="window.scrollTo(0,0);return false;">Back to top</a>
        </p>
        <p>
          Designed and built by the good folks at <a href="http://transparensee.com">Transparensee Systems</a>.
        </p>
      </div>
    </footer>
    <!--[if IE]>
      <script src="//cdn.transparensee.com/lib/xdr/984c41/xdr.min.js"></script>
      <script src="//cdn.transparensee.com/lib/json2/2010-11-17/json2.min.js"></script>
      <script src="//cdn.transparensee.com/lib/jquery-plugin/bgiframe/2.1.2/jquery.bgiframe.min.js"></script>
    <![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js"></script>
    <script src="//cdn.transparensee.com/lib/jquery-plugin/touchpunch/0.2.2/jquery.ui.touch-punch.min.js"></script>
    <script src="//cdn.transparensee.com/lib/jquery-plugin/bbq/1.2.1/jquery.ba-bbq.min.js"></script>
    <script src="//cdn.transparensee.com/lib/bootstrap/2.1.1/bootstrap.min.js"></script>
    <script src="//cdn.transparensee.com/simplicity/3.2/simplicity.min.js"></script>
    <script src="/js/documentation.js"></script>
  </body>
</html>
